#!/usr/bin/make -f

myroot=$(CURDIR)/debian/univention-bareos
schemaroot=$(CURDIR)/debian/univention-bareos-schema

# Add here any variable or target overrides you need.
clean:
	dh_testdir
	dh_testroot
	dh_clean

build:

install_app_data:
	dh_testdir
	dh_testroot
	dh_prep
	dh_installdirs -v
	univention-install-config-registry
	# dbconfig-common
	cp postgres_create.sql $(myroot)/usr/share/dbconfig-common/data/univention-bareos/install/pgsql
	cp fd-windows.template $(myroot)/etc/bareos/autogenerated/fd-configs/windows.template
	cp fd-generic.template $(myroot)/etc/bareos/autogenerated/fd-configs/generic.template
	cp job-windows.template $(myroot)/etc/bareos/autogenerated/clients/windows.template
	cp job-generic.template $(myroot)/etc/bareos/autogenerated/clients/generic.template
	cp univention-bareos.py $(myroot)/usr/lib/univention-directory-listener/system
	cp restart_director $(myroot)/usr/share/univention-bareos
	cp univention-bareos.cron $(myroot)/etc/cron.d/univention-bareos
	install -m 755 62univention-bareos.inst $(myroot)/usr/lib/univention-install/
	install -m 755  63univention-bareos-uninstall.uinst $(myroot)/usr/lib/univention-uninstall/
	cp bareos.schema $(schemaroot)/usr/share/univention-bareos-schema/univention-bareos.schema

install_package_data:
	dh_installchangelogs
	dh_compress
	dh_installdebconf
	dh_installdeb
	dh_installdocs
	dh_fixperms
	dh_gencontrol
	dh_md5sums
	dh_builddeb
	dh_lintian

override_dh_auto_install:
	univention-install-config-registry
	dh_auto_install


install: install_app_data install_package_data
binary-indep: build install
binary-arch: binary-indep
binary: binary-indep
.PHONY: clean install install_app_data install_package_data
